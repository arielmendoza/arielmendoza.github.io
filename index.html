<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Herramientas de Bricolaje - Afiliados Amazon España</title>
<style>
  /* Reset básico */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f5f7fa;
    margin: 0;
    color: #333;
    line-height: 1.6;
  }
  header {
    background: #0073e6;
    color: white;
    padding: 1rem 2rem;
    text-align: center;
    font-size: 1.8rem;
    font-weight: 700;
    letter-spacing: 1px;
  }
  main {
    max-width: 1000px;
    margin: 2rem auto;
    padding: 0 1rem;
  }
  .tool-list {
    display: grid;
    grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
    gap: 1.5rem;
  }
  .tool-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgb(0 0 0 / 0.1);
    padding: 1rem;
    display: flex;
    flex-direction: column;
  }
  .tool-name {
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 0.5rem;
    color: #0073e6;
  }
  .photos {
    display: flex;
    gap: 0.4rem;
    margin-bottom: 0.8rem;
  }
  .photos img {
    width: 48px;
    height: 48px;
    object-fit: cover;
    border-radius: 4px;
    border: 1px solid #ddd;
  }
  .rating {
    margin-bottom: 0.5rem;
    color: #f5a623;
    font-weight: 600;
  }
  .price {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }
  .price.offer {
    color: #d32f2f;
  }
  button.details-btn {
    margin-top: auto;
    background: #0073e6;
    color: white;
    border: none;
    padding: 0.6rem 1rem;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }
  button.details-btn:hover {
    background: #005bb5;
  }
  footer {
    max-width: 1000px;
    margin: 3rem auto 1rem;
    padding: 0 1rem;
    font-size: 0.9rem;
    color: #666;
    text-align: center;
  }

  /* Modal styles */
  .modal {
    display: none;
    position: fixed;
    z-index: 9999;
    left: 0; top: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.6);
    justify-content: center;
    align-items: center;
    padding: 1rem;
  }
  .modal.active {
    display: flex;
  }
  .modal-content {
    background: white;
    border-radius: 8px;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    padding: 1.5rem;
    position: relative;
    box-shadow: 0 8px 24px rgb(0 0 0 / 0.2);
  }
  .modal-close {
    position: absolute;
    top: 12px;
    right: 12px;
    background: transparent;
    border: none;
    font-size: 1.8rem;
    cursor: pointer;
    color: #555;
  }
  .modal-title {
    font-size: 1.6rem;
    margin-bottom: 1rem;
    color: #0073e6;
  }
  .modal-photos {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    overflow-x: auto;
  }
  .modal-photos img {
    height: 100px;
    border-radius: 6px;
    object-fit: cover;
    flex-shrink: 0;
  }
  .modal-info {
    margin-bottom: 1rem;
  }
  .modal-info span {
    font-weight: 700;
  }
  .modal-review {
    white-space: pre-wrap;
    font-size: 1rem;
    color: #444;
  }
</style>
</head>
<body>

<header>Herramientas de Bricolaje - Afiliados Amazon España</header>

<main>
  <section id="tool-list" class="tool-list" aria-label="Listado de herramientas de bricolaje">
    <!-- Aquí se cargan las herramientas -->
  </section>
</main>

<footer>
  <p>
    Este sitio web participa en el Programa de Afiliados de Amazon EU, un programa de publicidad afiliada diseñado para proporcionar un medio para ganar comisiones mediante enlaces a Amazon.es. Los precios y la disponibilidad de los productos pueden variar sin previo aviso.
  </p>
</footer>

<!-- Modal para detalles -->
<div id="modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
  <div class="modal-content">
    <button class="modal-close" aria-label="Cerrar ventana">&times;</button>
    <h2 id="modal-title" class="modal-title"></h2>
    <div class="modal-photos"></div>
    <div class="modal-info"></div>
    <div class="modal-review"></div>
  </div>
</div>

<script>
  // XML de ejemplo (normalmente lo cargarías externamente o por fetch)
  const xmlString = `<?xml version="1.0" encoding="UTF-8"?>
  <tools>
    <tool id="1">
      <name>Taladro inalámbrico Bosch Professional GSR 18V-28</name>
      <photos>
        <photo>images/bosch1.jpg</photo>
        <photo>images/bosch2.jpg</photo>
        <photo>images/bosch3.jpg</photo>
        <photo>images/bosch4.jpg</photo>
        <photo>images/bosch5.jpg</photo>
      </photos>
      <rating>4.7</rating>
      <price currency="EUR">129.99</price>
      <offer>true</offer>
      <review><![CDATA[
      El taladro inalámbrico Bosch Professional GSR 18V-28 es una herramienta potente y versátil, ideal para bricolaje y uso profesional ligero. Su batería de 18V ofrece una autonomía adecuada para trabajos prolongados sin perder potencia. El diseño ergonómico facilita su manejo, incluso en espacios reducidos. Entre sus pros destacan la buena duración de la batería, la variedad de velocidades y el portabrocas sin llave que agiliza el cambio de accesorios. Como contras, el peso puede resultar algo elevado para trabajos en altura y el precio es superior a otras opciones básicas. En general, es una inversión que vale la pena para quienes buscan calidad y durabilidad.
      ]]></review>
    </tool>
    <!-- Aquí irían los otros 9 productos, omitidos para brevedad -->
  </tools>`;

  // Función para parsear XML y generar HTML
  function loadToolsFromXML(xmlStr) {
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(xmlStr, "text/xml");
    const tools = xmlDoc.getElementsByTagName("tool");
    const container = document.getElementById("tool-list");
    container.innerHTML = "";

    for (let i = 0; i < tools.length; i++) {
      const tool = tools[i];
      const id = tool.getAttribute("id");
      const name = tool.getElementsByTagName("name")[0].textContent;
      const photos = tool.getElementsByTagName("photo");
      const rating = tool.getElementsByTagName("rating")[0].textContent;
      const price = tool.getElementsByTagName("price")[0].textContent;
      const currency = tool.getElementsByTagName("price")[0].getAttribute("currency") || "EUR";
      const offer = tool.getElementsByTagName("offer")[0].textContent === "true";
      const review = tool.getElementsByTagName("review")[0].textContent.trim();

      // Fotos pequeñas (hasta 5)
      let photosHTML = "";
      for (let p = 0; p < Math.min(photos.length, 5); p++) {
        photosHTML += `<img src="${photos[p].textContent}" alt="${name} foto ${p+1}" loading="lazy" />`;
      }

      // Precio con formato
      const priceFormatted = new Intl.NumberFormat('es-ES', { style: 'currency', currency }).format(price);

      // Tarjeta producto
      const card = document.createElement("article");
      card.className = "tool-card";
      card.innerHTML = `
        <h3 class="tool-name">${name}</h3>
        <div class="photos">${photosHTML}</div>
        <div class="rating" aria-label="Valoración en Amazon: ${rating} de 5 estrellas">${"⭐".repeat(Math.round(rating))} (${rating})</div>
        <div class="price ${offer ? "offer" : ""}">${priceFormatted}${offer ? " - ¡Oferta!" : ""}</div>
        <button class="details-btn" aria-expanded="false" aria-controls="modal" data-id="${id}">Ver detalles</button>
      `;

      container.appendChild(card);
    }
  }

  // Mostrar modal con detalles
  function showModal(toolData) {
    const modal = document.getElementById("modal");
    const title = modal.querySelector(".modal-title");
    const photosContainer = modal.querySelector(".modal-photos");
    const info = modal.querySelector(".modal-info");
    const review = modal.querySelector(".modal-review");

    title.textContent = toolData.name;

    photosContainer.innerHTML = "";
    toolData.photos.forEach((src, i) => {
      const img = document.createElement("img");
      img.src = src;
      img.alt = `${toolData.name} foto ${i + 1}`;
      photosContainer.appendChild(img);
    });

    const priceFormatted = new Intl.NumberFormat('es-ES', { style: 'currency', currency: toolData.currency }).format(toolData.price);

    info.innerHTML = `
      <p><strong>Valoración:</strong> ${toolData.rating} ⭐</p>
      <p><strong>Precio:</strong> ${priceFormatted} ${toolData.offer ? "<span style='color:#d32f2f;font-weight:700;'>- ¡Oferta!</span>" : ""}</p>
    `;

    review.textContent = toolData.review;

    modal.classList.add("active");
  }

  // Cerrar modal
  function closeModal() {
    const modal = document.getElementById("modal");
    modal.classList.remove("active");
  }

  // Al cargar la página
  document.addEventListener("DOMContentLoaded", () => {
    // Parsear XML y mostrar listado
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(xmlString, "text/xml");
    const tools = xmlDoc.getElementsByTagName("tool");

    // Convertir XML a array JS para acceso fácil
    const toolsData = [];
    for (let i = 0; i < tools.length; i++) {
      const tool = tools[i];
      const id = tool.getAttribute("id");
      const name = tool.getElementsByTagName("name")[0].textContent;
      const photosNodes = tool.getElementsByTagName("photo");
      const photos = [];
      for (let p = 0; p < photosNodes.length; p++) {
        photos.push(photosNodes[p].textContent);
      }
      const rating = tool.getElementsByTagName("rating")[0].textContent;
      const price = parseFloat(tool.getElementsByTagName("price")[0].textContent);
      const currency = tool.getElementsByTagName("price")[0].getAttribute("currency") || "EUR";
      const offer = tool.getElementsByTagName("offer")[0].textContent === "true";
      const review = tool.getElementsByTagName("review")[0].textContent.trim();

      toolsData.push({ id, name, photos, rating, price, currency, offer, review });
    }

    // Mostrar listado
    const container = document.getElementById("tool-list");
    container.innerHTML = "";
    toolsData.forEach(tool => {
      const photosHTML = tool.photos.slice(0,5).map((src,i) => `<img src="${src}" alt="${tool.name} foto ${i+1}" loading="lazy" />`).join("");
      const priceFormatted = new Intl.NumberFormat('es-ES', { style: 'currency', currency: tool.currency }).format(tool.price);
      const card = document.createElement("article");
      card.className = "tool-card";
      card.innerHTML = `
        <h3 class="tool-name">${tool.name}</h3>
        <div class="photos">${photosHTML}</div>
        <div class="rating" aria-label="Valoración en Amazon: ${tool.rating} de 5 estrellas">${"⭐".repeat(Math.round(tool.rating))} (${tool.rating})</div>
        <div class="price ${tool.offer ? "offer" : ""}">${priceFormatted}${tool.offer ? " - ¡Oferta!" : ""}</div>
        <button class="details-btn" aria-expanded="false" aria-controls="modal" data-id="${tool.id}">Ver detalles</button>
      `;
      container.appendChild(card);
    });

    // Eventos para botones detalles
    container.addEventListener("click", e => {
      if (e.target.classList.contains("details-btn")) {
        const id = e.target.getAttribute("data-id");
        const tool = toolsData.find(t => t.id === id);
        if (tool) {
          showModal(tool);
          e.target.setAttribute("aria-expanded", "true");
        }
      }
    });

    // Cerrar modal
    const modal = document.getElementById("modal");
    modal.querySelector(".modal-close").addEventListener("click", () => {
      closeModal();
      // Restaurar aria-expanded en botón
      const expandedBtn = container.querySelector('button[aria-expanded="true"]');
      if (expandedBtn) expandedBtn.setAttribute("aria-expanded", "false");
    });

    // Cerrar modal al hacer clic fuera del contenido
    modal.addEventListener("click", e => {
      if (e.target === modal) {
        closeModal();
        const expandedBtn = container.querySelector('button[aria-expanded="true"]');
        if (expandedBtn) expandedBtn.setAttribute("aria-expanded", "false");
      }
    });

    // Cerrar modal con Escape
    document.addEventListener("keydown", e => {
      if (e.key === "Escape" && modal.classList.contains("active")) {
        closeModal();
        const expandedBtn = container.querySelector('button[aria-expanded="true"]');
        if (expandedBtn) expandedBtn.setAttribute("aria-expanded", "false");
      }
    });
  });
</script>

</body>
</html>
